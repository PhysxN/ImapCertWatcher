<Window x:Class="ImapCertWatcher.ServerSettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Настройки сервера"
        Width="920"
        Height="600"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ================= LEFT COLUMN ================= -->

        <StackPanel Grid.Column="0">

            <!-- MAIL -->
            <TextBlock Text="Почта" FontWeight="Bold" Margin="0,0,0,6"/>

            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="IMAP сервер"/>
                <TextBox Grid.Row="0" Grid.Column="1"
                         Text="{Binding MailHost, Mode=TwoWay}"/>

                <TextBlock Grid.Row="1" Text="Порт"/>
                <TextBox Grid.Row="1" Grid.Column="1"
                         Text="{Binding MailPort, Mode=TwoWay}"/>

                <TextBlock Grid.Row="2" Text="SSL"/>
                <CheckBox Grid.Row="2" Grid.Column="1"
                          IsChecked="{Binding MailUseSsl, Mode=TwoWay}"/>

                <TextBlock Grid.Row="3" Text="Логин"/>
                <TextBox Grid.Row="3" Grid.Column="1"
                         Text="{Binding MailLogin, Mode=TwoWay}"/>

                <TextBlock Grid.Row="4" Text="Пароль"/>
                <PasswordBox Grid.Row="4" Grid.Column="1"
                             x:Name="MailPasswordBox"/>
            </Grid>

            <Button Content="Проверить почту"
                    HorizontalAlignment="Right"
                    Click="TestMail_Click"
                    Margin="0,0,0,12"/>

            <!-- IMAP FOLDERS -->

            <TextBlock Text="IMAP папки"
                       FontWeight="Bold"
                       Margin="0,0,0,6"/>

            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition Height="6"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Новые сертификаты"/>
                <ComboBox Grid.Row="0" Grid.Column="1"
                          x:Name="cmbNewCertsFolder"
                          ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ImapFolders}"
                          SelectedItem="{Binding ImapNewCertificatesFolder}"
                          IsEditable="True"
                          IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=IsFoldersLoaded}"/>

                <TextBlock Grid.Row="1" Text="Аннулирования"/>
                <ComboBox Grid.Row="1" Grid.Column="1"
                          x:Name="cmbRevocationsFolder"
                          ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=ImapFolders}"
                          SelectedItem="{Binding ImapRevocationsFolder}"
                          IsEditable="True"
                          IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=IsFoldersLoaded}"/>

                <ProgressBar Grid.Row="2"
                             Grid.ColumnSpan="2"
                             Height="4"
                             Margin="0,4,0,0"
                             IsIndeterminate="True"
                             Visibility="{Binding RelativeSource={RelativeSource AncestorType=Window},
                             Path=IsFoldersLoading,
                             Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>

            <!-- SERVER -->

            <Separator Margin="0,12"/>

            <TextBlock Text="Сервер"
                       FontWeight="Bold"
                       Margin="0,0,0,6"/>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Интервал (мин)"/>
                <TextBox Grid.Row="0" Grid.Column="1"
                         Text="{Binding CheckIntervalMinutes}"/>

                <TextBlock Grid.Row="1" Text="Уведомлять за (дней)"/>
                <TextBox Grid.Row="1" Grid.Column="1"
                         Text="{Binding NotifyDaysThreshold}"/>
            </Grid>

            <CheckBox Content="Рабочее время"
                      IsChecked="{Binding NotifyOnlyInWorkHours}"
                      Margin="0,6,0,0"/>
            <CheckBox Content="Сворачивать в трей при закрытии"
                      IsChecked="{Binding MinimizeToTrayOnClose, Mode=TwoWay}"
                      Margin="0,6,0,0"
                      ToolTip="Если включено — окно будет скрываться в трей вместо закрытия"/>

        </StackPanel>

        <!-- ================= RIGHT COLUMN ================= -->

        <StackPanel Grid.Column="2">

            <!-- FIREBIRD -->

            <TextBlock Text="Firebird"
                       FontWeight="Bold"
                       Margin="0,0,0,6"/>

            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Сервер"/>
                <TextBox Grid.Row="0" Grid.Column="1"
                         Text="{Binding FbServer}"/>

                <TextBlock Grid.Row="1" Text="Путь к БД"/>
                <TextBox Grid.Row="1" Grid.Column="1"
                         Text="{Binding FirebirdDbPath}"/>

                <TextBlock Grid.Row="2" Text="Логин"/>
                <TextBox Grid.Row="2" Grid.Column="1"
                         Text="{Binding FbUser}"/>

                <TextBlock Grid.Row="3" Text="Пароль"/>
                <PasswordBox Grid.Row="3" Grid.Column="1"
                             x:Name="DbPasswordBox"/>

                <TextBlock Grid.Row="4" Text="Диалект"/>
                <TextBox Grid.Row="4" Grid.Column="1"
                         Text="{Binding FbDialect}"/>
            </Grid>

            <Button Content="Проверить Firebird"
                    HorizontalAlignment="Right"
                    Click="TestDb_Click"
                    Margin="0,0,0,12"/>

            <!-- BIMOID -->

            <Separator Margin="0,12"/>

            <TextBlock Text="Bimoid"
                       FontWeight="Bold"
                       Margin="0,0,0,6"/>

            <TextBlock Text="Краснофлотская"/>
            <TextBox Text="{Binding BimoidAccountsKrasnoflotskaya}"
                     AcceptsReturn="True"
                     Height="60"/>

            <TextBlock Text="Пионерская"
                       Margin="0,6,0,0"/>
            <TextBox Text="{Binding BimoidAccountsPionerskaya}"
                     AcceptsReturn="True"
                     Height="60"/>

            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,8,0,0">

                <Button Content="Тестовое сообщение"
                        Width="160"
                        Margin="0,0,8,0"
                        Click="BtnTestBimoid_Click"/>

                <Button Content="Тест нового пользователя"
                        Width="180"
                        Click="BtnTestNewUserNotify_Click"/>
            </StackPanel>

            <Separator Margin="0,12"/>

            <Button Content="Сохранить"
                    Width="140"
                    HorizontalAlignment="Right"
                    Click="Save_Click"/>

        </StackPanel>

    </Grid>
</Window>
